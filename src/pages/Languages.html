<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link href="../output.css" rel="stylesheet" />
    <script src="https://unpkg.com/lucide@latest"></script>

    <title>Tour Guide Admin Panel</title>
  </head>
  <body class="bg-gray-100 font-sans">
    <div class="flex min-h-screen">
      <!-- Sidebar -->
      <aside class="w-64 bg-white border-r shadow-md">
        <div class="p-6 border-b">
          <img src="../img/Vector.png" alt="main logo" />
        </div>
        </div>
        <nav class="p-4 space-y-3">
          <a
            href="home.html"
            class="flex items-center gap-3 px-4 py-2 rounded-lg text-gray-700 hover:bg-blue-100"
          >
            <i data-lucide="map"></i> <span>Trips</span>
          </a>
          <a
            href="categories.html"
            class="flex items-center gap-3 px-4 py-2 rounded-lg text-gray-700 hover:bg-blue-100"
          >
            <i data-lucide="folder"></i> <span>Categories</span>
          </a>
          <a
            href="includes.html"
            class="flex items-center gap-3 px-4 py-2 rounded-lg text-gray-700 hover:bg-blue-100"
          >
            <i data-lucide="check-square"></i> <span>Includes</span>
          </a>
          <a
            href="Languages.html"
            class="flex items-center gap-3 px-4 py-2 rounded-lg text-gray-700 bg-blue-100 shadow-inner font-medium"
          >
            <i data-lucide="languages"></i> <span>Languages</span>
          </a>
          <a
            href="activities.html"
            class="flex items-center gap-3 px-4 py-2 rounded-lg text-gray-700 hover:bg-blue-100"
          >
            <i data-lucide="activity"></i> <span>Activities</span>
          </a>
          <a
            href="#"
            class="flex items-center gap-3 px-4 py-2 rounded-lg text-gray-700 hover:bg-blue-100"
          >
            <i data-lucide="calendar-check"></i> <span>Bookings</span>
          </a>
          <a
            href="#"
            class="flex items-center gap-3 px-4 py-2 rounded-lg text-red-600 hover:bg-red-100"
          >
            <i data-lucide="log-out"></i> <span>Logout</span>
          </a>
        </nav>
      </aside>

      <!-- Main Content -->
      <main class="flex-1 p-8">
        <div
          class="flex flex-col md:flex-row justify-between items-center mb-6 gap-4"
        >
          <h1 class="text-3xl font-bold text-gray-900">Manage Languages</h1>
          <button
            class="flex items-center gap-2 bg-blue-600 hover:bg-blue-700 text-white px-6 py-2 rounded-lg shadow"
            id="addLangBtn"
          >
            <i data-lucide="plus"></i>
            Add Language
          </button>
        </div>

        <!-- <div class="mb-4">
          <input
            id="searchInput"
            type="text"
            placeholder="Search Language"
            class="w-full border border-gray-300 rounded px-3 py-2"
          />
        </div> -->

        <!-- Trip Table -->
        <div class="bg-white rounded-xl shadow overflow-x-auto">
          <table class="min-w-full text-sm text-left">
            <thead class="bg-gray-100 text-gray-600 uppercase text-xs">
              <tr>
                <th class="px-6 py-4">ID</th>
                <th class="px-6 py-4">Language</th>
                <th class="px-6 py-4">Actions</th>
              </tr>
            </thead>
            <tbody id="langTable" class="divide-y divide-gray-200 bg-white">
              <!-- Trip rows go here -->
            </tbody>
          </table>
        </div>
      </main>
    </div>

    <!-- Modal (hidden by default) -->
    <div
      id="langModel"
      class="fixed top-0 right-0 z-50 h-full w-full max-w-md bg-white shadow-xl transform translate-x-full transition-transform duration-300 ease-in-out hidden"
    >
      <div class="p-6 flex flex-col h-full">
        <div class="flex items-center justify-between mb-4">
          <h2 class="text-xl font-semibold text-gray-800">Add language</h2>
          <button
            type="button"
            id="cancelBtn"
            class="text-gray-500 hover:text-gray-700 text-2xl leading-none"
          >
            &times;
          </button>
        </div>

        <form id="langForm" class="flex flex-col flex-1 gap-6 overflow-auto">
          <input type="hidden" id="langId" name="id" />

          <div class="space-y-1">
            <label class="block font-medium">language Name</label>
            <input
              title="Name"
              type="text"
              name="Name"
              class="w-full border rounded-lg px-4 py-2 focus:ring-2 focus:ring-blue-500"
              required
            />
          </div>

          <div class="mt-auto flex justify-end space-x-3">
            <button
              type="button"
              id="cancelBtn"
              class="px-5 py-2 rounded bg-gray-200 hover:bg-gray-300"
            >
              Cancel
            </button>
            <button
              type="submit"
              class="px-5 py-2 rounded bg-blue-600 hover:bg-blue-700 text-white"
            >
              Save
            </button>
          </div>
        </form>
      </div>
    </div>

    <script>
      lucide.createIcons();

      const modal = document.getElementById("langModel");
      const form = document.getElementById("langForm");
      const tableBody = document.getElementById("langTable");


      // Load categories on page load
      async function loadLanguages(searchQuery = "") {
        try {
          let url = `/api/Language/GetAllLanguages`;

          const res = await fetch(url);
          const data = await res.json();
          console.log("API response:", data);

          if (res.ok && data.succeeded) {
            const languages = data.data;
            tableBody.innerHTML = "";

            languages.forEach((lang) => {
              const row = document.createElement("tr");
              row.innerHTML = `
            <td class="px-6 py-3">${lang.id}</td>
            <td class="px-6 py-3">${lang.name}</td>
            <td class="px-6 py-3">
                  <button class="text-blue-400 hover:text-blue-900" title="Edit" onclick="editLang(${
                    lang.id
                  }, '${lang.name.replace(/'/g, "\\'")}')">
                <i data-lucide="pencil"></i>
                  
                  </button>

              <button class="text-red-400 hover:text-red-900" title="Delete" onclick="deleteLang(${
                lang.id
              })">
                 <i data-lucide="trash-2"></i>

              </button>
            </td>
          `;
              tableBody.appendChild(row);
            });
            lucide.createIcons();
          } else {
            alert("Failed to load Languages");
          }
        } catch (err) {
          console.error(err);
          alert("Error loading Languages");
        }
      }

      function editLang(id, name) {
        form.elements["Name"].value = name;
        form.elements["id"].value = id;
        modal.classList.remove("hidden");
      }

      // Add a new Lang
      form.addEventListener("submit", async (e) => {
        e.preventDefault();

        const id = form.elements["id"].value;
        const name = form.elements["Name"].value;
        const formData = { name };

        const isEdit = Boolean(id);

        const endpoint = isEdit
          ? `/api/Language/UpdateLanguage/${id}`
          : `/api/Language/AddLanguage`;

        const method = isEdit ? "PUT" : "POST";

        try {
          const res = await fetch(endpoint, {
            method,
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(formData),
          });

          const data = await res.json();
          if (res.ok && data.succeeded) {
            alert(isEdit ? "Language updated!" : "Language added!");
            form.reset();
            modal.classList.add("hidden");
            loadLanguages();
          } else {
            alert("Failed: " + (data.message || "Unknown error"));
          }
        } catch (err) {
          console.error(err);
          alert("Error while saving Language.");
        }
      });

      // Delete Lang
      async function deleteLang(id) {
        if (!confirm("Are you sure you want to delete this Language?")) return;

        try {
          const res = await fetch(
            `/api/Language/DeleteLanguage/${id}`,
            {
              method: "DELETE",
            }
          );

          const data = await res.json();
          if (res.ok && data.succeeded) {
            alert("Language deleted");
            loadLanguages();
          } else {
            alert("Failed to delete Language");
          }
        } catch (err) {
          console.error(err);
          alert("Error deleting Language");
        }
      }

      // Show modal
      document.getElementById("addLangBtn").addEventListener("click", () => {
        modal.classList.remove("hidden");
        setTimeout(() => modal.classList.remove("translate-x-full"), 10);
      });

      document.querySelectorAll("#cancelBtn").forEach((btn) => {
        btn.addEventListener("click", () => {
          modal.classList.add("translate-x-full");
          setTimeout(() => modal.classList.add("hidden"), 300);
          form.reset();
        });
      });

      // Initial load
      loadLanguages();
    </script>
  </body>
</html>
